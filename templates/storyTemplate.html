<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="Pasqual Valentina, Enrica Bruno, Francesca Tomasi">
  <title>ODI</title>
  <!-- custom css -->
  <link rel="stylesheet" href="../assets/style.css">
  <!-- boostrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
  <!-- visnetwork -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis-network.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis-network.min.css" type="text/css">
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <!-- cookies and analytics -->
  <script src="../assets/js/stats.js"></script>
  <script src="../assets/js/matomo.js"></script>
</head>
<body>
 <div id="graphContainer"></div>

</style>
</head>

<body>

  <div class="container-fluid">
  <div class="row flex-nowrap">
      <div class="col-auto col-md-3 col-xl-2 px-sm-2 px-0" id="sidebar">
          <div class="d-flex flex-column align-items-center align-items-sm-start px-3 pt-2 min-vh-100">
              <a href="../" class="d-flex align-items-center pb-3 mb-md-0 me-md-auto text-decoration-none">
                  <span class="fs-5 d-none d-sm-inline pt-4">ODI</span>
              </a>
              <p class="side-small-text d-none d-md-inline" style="word-break: break-all !important">
                <i>Esplorazione semantica della macchina narrativa combinatoria de "Il castello dei destini incrociati"<br>di Italo Calvino</i>
              </p>
              <hr>
              <ul class="nav nav-pills flex-column mb-sm-auto mb-0 align-items-center align-items-sm-start" id="menu">
                  <li class="nav-item">
                      <a href="../" class="nav-link align-middle px-0">
                        <i class="bi bi-house-fill"></i>
                          <span class="ms-1 d-none d-sm-inline">Introduzione</span>
                      </a>
                  </li>
                  <li class="nav-item">
                      <a href="../indici" class="nav-link align-middle px-0">
                          <i class="bi bi-arrow-down-left-square-fill"></i>
                          <span class="ms-1 d-none d-sm-inline">Indici</span>
                      </a>
                  </li>
                  <li class="nav-item">
                      <a href="#"  class="nav-link align-middle px-0">
                        <i class="bi bi-bar-chart-line-fill"></i>
                        <span class="ms-1 d-none d-sm-inline">Visualizzazioni dei Dati</span> </a>
                  </li>
                  <li class="nav-item">
                      <a href="../sparql" class="nav-link align-middle px-0">
                        <i class="bi bi-question-circle"></i>
                        <span class="ms-1 d-none d-sm-inline">SPARQL endpoint</span></a>
                  </li>
              </ul>
              <hr>
              <div class="dropdown pb-4">
                <ul class="nav nav-pills flex-column mb-sm-auto mb-0 align-items-center align-items-sm-start" id="menu">
                  <li class="nav-item">
                      <a href="https://odi-documentation.github.io/materials/" class="nav-link align-middle px-0" target="_blank">
                        <i class="bi bi-journal-bookmark-fill"></i>
                          <span class="ms-1 d-none d-sm-inline">Documentazione <i class="bi bi-box-arrow-up-right"></i></span>
                      </a>
                  </li>
                  <li class="nav-item">
                      <a href="https://github.com/ODI-documentation/materials" class="nav-link align-middle px-0" target="_blank">
                        <i class="bi bi-github"></i>
                          <span class="ms-1 d-none d-sm-inline">Repository <i class="bi bi-box-arrow-up-right"></i></span>
                      </a>
                  </li>
                  <li class="nav-item">
                      <a href="../contatti" class="nav-link align-middle px-0">
                        <i class="bi bi-person-circle"></i>
                          <span class="ms-1 d-none d-sm-inline">Contatti</span>
                      </a>
                  </li>
                  </ul>
              </div>
          </div>
      </div>
      <div class="col py-3">

        <div id="breadcrumbs" class="text-end"></div>
  <!-- main content -->
  <main class="d-flex flex-nowrap">

    <div class="card w-100">
      <div class="card-header">
        <h1 class="text-center p-3">{{storyTitle}}{%if storyName != '' %}, <i>{{storyName}}</i>{% endif %}</h1>
      </div>
      <div class="card-body">
            <h5 class="card-title p-3">Sinossi della storia</h5>
            <p class="card-text p-3">{{storyDescription}}</p>
<div id="embedded-content"></div>
      </div>
      <div class="card-footer text-muted">

        <div class="row">
          <div class="col-md-8">
            <div class="accordion accordion-flush" id="accordionFlushExample">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingOne">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
<h3 class="card-title p-3">Interpretazioni</h3>
                    <i class="bi bi-info-circle-fill"></i>
                  </button>
                </h2>
                <div id="flush-collapseOne" class="accordion-collapse collapse" aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample">
                <div class="accordion-body">
                  <ul>
                    <li>
                      <b>Posizione</b>: Ogni storia si forma tramite la scelta sequenziale di alcune carte del mazzo dei Tarocchi. La posizione indica dunque la sequenza di carte che forma la narrativa della storia.
                    </li>
                  <li><b>Carta</b>: Rappresenta il nome della carta del mazzo dei Tarocchi. Ogni carta ha un significato simbolico e rappresenta un'idea o una situazione specifica.</li>
                  <li><b>Compare in</b>: Indica il contesto (e dunque la storia) in cui la carta appare.</b>

                  <li><b>Significato</b>: Rappresenta il significato associato alla carta. Ogni carta dei Tarocchi ha una serie di significati interpretativi, che possono variare in base al contesto e alla posizione nella lettura.</li>

                  <li><b>Riferimento al testo</b>: Fornisce un estratto o una descrizione del testo che accompagna o descrive la carta. In questo caso, viene fornita una o più brevi citazioni (indicate tra uncinate) o una spiegazione il simbolismo della carta (in testo libero). Se un'interpretazione si basa su più riferimenti testuali, questi vengono separati tramite il segno //"</li>
                </ul>
                </div>
            </div>
          </div>
        </div>


        </div>
          <div class="col-md-4 p-3 text-end">
          <a href="#network-container" class="p-3">Network delle relazioni<i class="bi bi-arrow-down"></i></a>
        </div>
      </div>
        <ul class="list-group list-group-flush pt-3">
           {% for res in storyResults['results']['bindings'] %}

            <li class="list-group-item">

              <div class="row w-100">
                <div class="col-md-2">
                      Posizione <span class="badge rounded-pill bg-success">{{res['position']['value']}}</span>
                </div>
                  <div class="col-md-5">
                    {% for res2 in storyRepresentationResult['results']['bindings'] %}
                    {% if res2['storyCard']['value'] == res['storyCard']['value'] %}
                    Carta: <a href="../{{res['deckCard']['value']|replace('https://w3id.org/odi/data/', '')}}" class="card-text">{{res["deckCardLabel"]['value']}}</a>
                    <p class="card-text">Significato: <a href="../{{res2['meaning']['value']|replace('https://w3id.org/odi/data/', '')}}" class="card-text">{{ res2['meaningLabel']['value'] }}</a></p>
                    {% endif %}
                    {% endfor %}
                  </div>
                <div class="col-md-5">
                  <p class="card-text">{{res['texts']['value']}}</p>
                </div>
              </div>
            </li>

         {% endfor %}

       </ul>

      </div>

      <div class="network card-footer" id="network-container">
        <h5 class="p-3">Collegamenti semantici e relazioni narrative tra le rappresentazioni delle carte</h5>
        <div class="network-contents p-3">
          <div id="legend-container">
            <div id="legend"></div>
            <div id="zoom-buttons" class="d-flex justify-content-end">
              <button class="btn btn-outline-dark" onclick="zoomIn()"><i class="bi bi-zoom-in"></i></button>
              <button class="btn btn-outline-dark" onclick="zoomOut()"><i class="bi bi-zoom-out"></i></button>
              <button class="btn btn-outline-dark" onclick="resetZoom()"><i class="bi bi-arrow-counterclockwise"></i></button>
            </div>
          </div>
        </div>
        <div id="network" class="p-3"></div>
      </div>
    </div>


  </main>
</div>
</div>
</div>

  <script type="text/javascript">

    function replaceHtmlEntities(input) {
    return input.replace(/&#39;/g, "'");
  }
   // Create a new network instance
   var allNodes = [
   {% for res in storyRelationsResult['results']['bindings'] %}
   { id:"{{res['representation']['value']}}", label:replaceHtmlEntities("{{res['reprLabel']['value']}}"), classLabel:replaceHtmlEntities("{{res['classLabel']['value']}}")},
   { id:"{{res['representation2']['value']}}", label:replaceHtmlEntities("{{res['reprLabel2']['value']}}"), classLabel:replaceHtmlEntities("{{res['classLabel2']['value']}}")},
   {% endfor %}
   {% for res in cardRelationsResult %}
   { id:"{{res['card']}}", label:"{{res['cardLabel']}}", classLabel:"Carta"},
   {% endfor %}
 ]

  var uniqueNodes = Array.from(new Set(allNodes.map(JSON.stringify)), JSON.parse);

   var container = document.getElementById("network")
   var data = {
     nodes: uniqueNodes,

     edges: [

    {% for res in storyRelationsResult['results']['bindings'] %}
      { from:  "{{res['representation']['value']}}", to:replaceHtmlEntities("{{res['representation2']['value']}}") , label: replaceHtmlEntities("{{res['relLabel']['value']}}")},
    {% endfor %}
    {% for res in cardRelationsResult %}
      { from:  "{{res['representation']}}", to: "{{res['card']}}" , label:""},
    {% endfor %}
     ]
   };

   console.log(data)


   // Set colors based on classLabel value
data.nodes.forEach(function(node) {
  var color;
  if (node.classLabel === "Personaggio") {
    color = "#7FB77E";
  } else if (node.classLabel === "Oggetto inanimato") {
    color = "#F7F6DC";
  } else if (node.classLabel === "Luogo ideale") {
    color = "#B1D7B4";
  } else if (node.classLabel === "Evento") {
    color = "#B7C9E2";
  } else if (node.classLabel === "Simbolo") {
      color = " #FFe4E1";
  } else {
    color = "#E0E0E0";
  }
  node.color = color;
});

   var options = {
     layout: {
         hierarchical: false, // Disable hierarchical layout
         randomSeed: 2, // Set a random seed for consistent results
         improvedLayout: true, // Enable improved layout algorithm
       },
  physics: {
    barnesHut: {
      gravitationalConstant: -2000,
      centralGravity: 0.3,
      springLength: 250,
      springConstant: 0.05,
      damping: 0.09,
      avoidOverlap: 0
    },
    maxVelocity: 50,
    minVelocity: 0.1,
    solver: "barnesHut",
    stabilization: {
      iterations: 250
    }
  }
};

// Create the legend dynamically
   var legendContainer = document.getElementById("legend");
   var legendItems = {};

   data.nodes.forEach(function(node) {
     if (!legendItems[node.classLabel]) {
       legendItems[node.classLabel] = node.color;
     }
   });

   for (var classLabel in legendItems) {
     var legendItem = document.createElement("span");
     legendItem.className = "legend-item";

     var legendColor = document.createElement("span");
     legendColor.className = "legend-color";
     legendColor.style.backgroundColor = legendItems[classLabel];

     var legendLabel = document.createElement("span");
     legendLabel.innerText = classLabel;

     legendItem.appendChild(legendColor);
     legendItem.appendChild(legendLabel);

     legendContainer.appendChild(legendItem);

   }

   var network = new vis.Network(container, data, options);


   // Zoom In function
   function zoomIn() {
     var scale = network.getScale();
     network.moveTo({
       scale: scale * 1.1, // Increase the scale by 10%
       animation: true, // Enable animation
       animationDuration: 1000 // Animation duration in milliseconds
     });
   }

   // Zoom Out function
   function zoomOut() {
     var scale = network.getScale();
     network.moveTo({
       scale: scale * 0.9, // Decrease the scale by 10%
       animation: true, // Enable animation
       animationDuration: 1000 // Animation duration in milliseconds
     });
   }

   // Reset Zoom function
function resetZoom() {
  network.moveTo({
    scale: 0.7, // Set the scale to the default value (1)
    animation: true, // Enable animation
    animationDuration: 1000 // Animation duration in milliseconds
  });
}
 </script>


</body>
</html>





</body>

</html>
